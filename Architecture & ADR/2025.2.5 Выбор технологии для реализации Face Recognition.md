- **Статус:** Принято
- **Дата:** 14 февраля 2025

**1. Контекст и постановка проблемы:**

Необходимо выбрать технологию (библиотеку, API, фреймворк) для реализации функции распознавания лиц в системе "TL Food". Эта функция используется в Kitchen Application для идентификации сотрудников при получении заказа. Ключевые требования:

- **Точность:** Высокая точность распознавания (минимизация ложноположительных и ложноотрицательных срабатываний). Целевые значения: True Positives >= 95%, False Positives <= 0.5%, False Negatives <= 5%.
- **Производительность:** Быстрое распознавание (не более 3 секунд).
- **Масштабируемость:** Возможность обработки увеличивающегося количества запросов (в будущем).
- **Безопасность:** Защита персональных данных (фотографий) пользователей.
- **Простота интеграции:** Относительная простота интеграции с существующей системой (C#, TypeScript).
- **Стоимость:** Учет стоимости использования (для облачных сервисов) или затрат на разработку и поддержку (для open-source решений).
- **Надежность.**
    

**2. Рассматриваемые варианты:**

- **Вариант 1: Облачный сервис распознавания лиц (Cloud Face Recognition API).**
    - Примеры: Azure Face API, Amazon Rekognition, Google Cloud Vision API, Face++.
    - Описание: Использование готового облачного сервиса, предоставляющего API для распознавания лиц. Отправляем изображение на сервер сервиса, получаем результат (идентификатор пользователя или сообщение об ошибке).
    - Преимущества:
        - **Простота интеграции:** Обычно предоставляются SDK (Software Development Kits) для разных языков программирования, упрощающие взаимодействие с API.
        - **Высокая точность:** Облачные сервисы, как правило, используют передовые алгоритмы и большие объемы данных для обучения, что обеспечивает \окую точность распознавания.
        - **Масштабируемость:** Облачные сервисы автоматически масштабируются для обработки большого количества запросов.
        - **Не нужно обучать собственную модель:** Это значительно экономит время и ресурсы.
        - **Регулярные обновления:** Облачные сервисы постоянно обновляются и улучшаются.
            
    - Недостатки
        - **Зависимость от стороннего сервиса:** Работа системы зависит от доступности и производительности облачного сервиса.
        - **Оплата:** За использование облачных сервисов взимается плата (обычно по количеству запросов). При большом количестве запросов стоимость может быть существенной.
            
        - **Приватность:** Необходимо передавать фотографии пользователей на сторонний сервер, что может вызывать вопросы, связанные с приватностью и безопасностью данных.
            
        - **Задержки:** Могут быть задержки, связанные с сетевым взаимодействием.
            
- **Вариант 2: Open-source библиотека с предобученной моделью.**
    
    - Примеры: Dlib, OpenCV (с модулем face), face_recognition (Python-библиотека, использующая Dlib).
        
    - Описание: Использование open-source библиотеки, которая предоставляет функции для распознавания лиц. Библиотека подключается к коду приложения (Face Recognition Service), распознавание выполняется локально (на сервере). Используется предобученная модель (т.е. модель, обученная на большом наборе данных), что позволяет избежать длительного и сложного процесса обучения.
        
    - Преимущества:
        
        - **Бесплатность:** Open-source библиотеки, как правило, бесплатны для использования.
            
        - **Полный контроль:** Вы имеете полный контроль над кодом и данными. Нет зависимости от сторонних сервисов.
            
        - **Приватность:** Фотографии пользователей не передаются на сторонние серверы.
            
        - **Низкие задержки:** Распознавание выполняется локально, что минимизирует сетевые задержки.
            
        - **Возможность дообучения:** При необходимости можно дообучить модель на собственном наборе данных (фотографиях сотрудников компании), чтобы повысить точность.
            
    - Недостатки:
        
        - **Сложность интеграции:** Может потребоваться больше усилий для интеграции open-source библиотеки, чем для использования готового API.
            
        - **Точность:** Точность распознавания может быть ниже, чем у облачных сервисов, особенно если используется не самая новая или не самая лучшая предобученная модель.
            
        - **Масштабируемость:** Для обеспечения масштабируемости потребуется самостоятельно настраивать инфраструктуру (добавлять серверы, балансировать нагрузку).
            
        - **Обновления:** Необходимо самостоятельно следить за обновлениями библиотеки и модели.
            
- **Вариант 3: Разработка собственного решения с нуля.**
    
    - Описание: Создание собственной системы распознавания лиц, включая сбор данных, обучение модели, разработку алгоритмов и т.д.
        
    - Преимущества:
        
        - Полный контроль над всеми аспектами системы.
            
        - Возможность создания решения, максимально адаптированного к специфическим требованиям проекта.
            
    - Недостатки:
        
        - **Чрезвычайно трудоемко:** Требуются глубокие знания в области машинного обучения, компьютерного зрения, обработки изображений.
            
        - **Дорого:** Требуются значительные ресурсы (время, вычислительные мощности, специалисты).
            
        - **Длительный срок разработки:** Создание собственной системы распознавания лиц с нуля займет очень много времени.
            
        - **Не гарантируется высокое качество:** Результат может быть хуже, чем у готовых решений.
            

**3. Решение:**

Использовать **готовый облачный сервис распознавания лиц (Вариант 1)**

**Разработка собственного решения с нуля (Вариант 3) отклоняется**, так как это нецелесообразно для данного проекта (MVP, студенческий проект, ограниченные сроки и ресурсы).

**4. Обоснование решения:**

- **Облачный сервис:** Оптимален, если требуется максимальная точность и простота интеграции, а затраты на использование сервиса приемлемы. Также подходит, если нет жестких требований по приватности данных (или если есть возможность заключить с провайдером сервиса соглашение об обработке персональных данных, гарантирующее их защиту).
    
- **Open-source библиотека:** Оптимальна, если критически важна приватность данных (фотографии не должны покидать пределы системы), а небольшое снижение точности распознавания по сравнению с облачными сервисами допустимо. Также подходит, если есть ограничения по бюджету (open-source решения бесплатны).
    

**5. Сравнительное тестирование (для выбора между Вариантом 1 и Вариантом 2):**

1. **Выбрать несколько** облачных сервисов (например, Azure Face API, Amazon Rekognition, Face++) и open-source библиотек (например, Dlib + face_recognition, OpenCV + face).
    
2. **Создать тестовый набор данных:** Собрать фотографии сотрудников компании (не менее 50 человек, по несколько фотографий на каждого человека, в разных условиях освещения и с разными выражениями лица). Важно получить согласие сотрудников на использование их фотографий для тестирования.
    
3. **Разработать тестовое приложение** (или скрипт), которое будет использовать выбранные сервисы/библиотеки для распознавания лиц из тестового набора данных.
    
4. **Провести тестирование:** Для каждого сервиса/библиотеки:
    
    - Измерить точность распознавания (True Positives, False Positives, False Negatives).
        
    - Измерить время распознавания (среднее время на одно изображение).
        
    - Оценить простоту интеграции (субъективно, по затраченному времени и усилиям).
        
5. **Сравнить результаты** и выбрать наиболее подходящий вариант, учитывая требования проекта (точность, производительность, стоимость, приватность).
    

**6. Последствия:**

Последствия выбора каждого из вариантов описаны в разделе "Рассматриваемые варианты".

**7. Метрики:**

- **Точность распознавания:** True Positives, False Positives, False Negatives.
    
- **Время распознавания:** Среднее время на одно изображение.
    
- **Затраты:** Стоимость использования облачного сервиса (если выбран Вариант 1) или затраты на разработку и поддержку (если выбран Вариант 2).
    
- **Надежность**